<!DOCTYPE html>
<html>
<head>
  <title>Ambulance Driver View</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.css" />
  <style>
    #map { height: 100vh; width: 100%; }
    .leaflet-marker-icon.custom-icon {
      background: none !important;
      border: none !important;
    }
    .rotating-icon {
      width: 50px;
      height: 50px;
      transform-origin: center;
    }
  </style>
</head>
<body>

<div id="map"></div>

<!-- Leaflet & Routing -->
<script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.min.js"></script>

<script>
  // Create map
  const map = L.map('map').setView([0, 0], 16);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19
  }).addTo(map);

  // SVG ambulance icon
  const ambulanceIcon = L.divIcon({
    className: 'custom-icon',
    html: `
      <svg class="rotating-icon" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
        <g>
          <rect x="10" y="20" width="44" height="24" rx="6" ry="6" fill="#e60000"/>
          <polygon points="32,10 28,20 36,20" fill="#fff" />
          <circle cx="20" cy="50" r="5" fill="#222"/>
          <circle cx="44" cy="50" r="5" fill="#222"/>
        </g>
      </svg>
    `,
    iconSize: [50, 50],
    iconAnchor: [25, 25]
  });

  // Get current location
  navigator.geolocation.getCurrentPosition(
    (position) => {
      const currentLat = position.coords.latitude;
      const currentLng = position.coords.longitude;
      const start = L.latLng(currentLat, currentLng);

      // Simulate destination ~50 meters northeast
      const offsetMeters = 50;
      const earthRadius = 6378137;
      const offsetLat = (offsetMeters / earthRadius) * (180 / Math.PI);
      const offsetLng = offsetLat / Math.cos(currentLat * Math.PI / 180);
      const destination = L.latLng(currentLat + offsetLat, currentLng + offsetLng);

      // Center the map
      map.setView(start, 18);

      // Add ambulance marker
      L.marker(start, { icon: ambulanceIcon }).addTo(map).bindPopup("You (Ambulance)").openPopup();

      // Add destination marker
      L.marker(destination).addTo(map).bindPopup("Destination");

      // Draw route
      L.Routing.control({
        waypoints: [start, destination],
        routeWhileDragging: false,
        draggableWaypoints: false,
        addWaypoints: false,
        createMarker: () => null,
        showAlternatives: false
      }).addTo(map);
    },
    (err) => {
      alert("Error getting your location: " + err.message);
    }
  );
</script>

</body>
</html>
